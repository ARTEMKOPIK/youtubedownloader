<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>YouTube Downloader</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>YouTube Downloader</h1>
        {% with messages = get_flashed_messages() %}
          {% if messages %}
            <ul class="messages">
            {% for message in messages %}
              <li>{{ message }}</li>
            {% endfor %}
            </ul>
          {% endif %}
        {% endwith %}
        <form id="download-form" action="#" method="post" class="download-form">
            <input type="text" name="url" placeholder="Enter YouTube URL" required>
            <select name="quality">
                <option value="best" selected>Best Video</option>
                <option value="1080p">1080p</option>
                <option value="720p">720p</option>
                <option value="480p">480p</option>
                <option value="audio">Audio (MP3)</option>
            </select>
            <button type="submit">Download</button>
        </form>
        <div id="progress-container" class="progress" style="display:none;">
            <div id="progress-bar" class="progress-bar"></div>
        </div>
        <div id="status"></div>
    </div>
    <script>
    document.getElementById('download-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        fetch('{{ url_for('start_download') }}', {method: 'POST', body: formData})
            .then(res => res.json())
            .then(data => {
                if (!data.job_id) {
                    document.getElementById('status').textContent = data.error || 'Error starting download';
                    return;
                }
                const jobId = data.job_id;
                document.getElementById('progress-container').style.display = 'block';
                const interval = setInterval(() => {
                    fetch('/progress/' + jobId)
                        .then(r => r.json())
                        .then(info => {
                            if (info.progress !== undefined) {
                                document.getElementById('progress-bar').style.width = info.progress + '%';
                            }
                            document.getElementById('status').textContent = info.status || '';
                            if (info.status === 'finished') {
                                clearInterval(interval);
                                window.location = '/file/' + jobId;
                            } else if (info.status === 'error') {
                                clearInterval(interval);
                            }
                        });
                }, 1000);
            });
    });
    </script>
</body>
</html>
